" Tests for default buffer groups

let s:expect = themis#helper('expect')

Describe Group:
  Before all
    let s:groups = g:bufswitcher#group#groups
  End

  After all
    unlet s:groups
  End

  Context All
    Before all
      call s:expect(s:groups).to_have_key('all')
    End

    It lists all buffers including unlisted buffers
      let bufnrs = []

      call add(bufnrs, g:Utils.tmp_buffer('b1'))
      call add(bufnrs, g:Utils.tmp_buffer('b2'))
      call add(bufnrs, g:Utils.tmp_buffer('b_unlisted1', 'setl nobuflisted'))

      tabnew
      call add(bufnrs, g:Utils.tmp_buffer('b4'))
      call add(bufnrs, g:Utils.tmp_buffer('b_unlisted2', 'setl nobuflisted'))

      wincmd s
      call add(bufnrs, g:Utils.tmp_buffer('b5'))
      call add(bufnrs, g:Utils.tmp_buffer('b_unlisted3', 'setl nobuflisted'))

      let buflister = g:bufswitcher#group#groups.all()
      for bufnr in bufnrs
        call s:expect(buflister.bufnames).to_have_key(bufnr)
      endfor
    End
  End

  Context Listed
    Before all
      call s:expect(s:groups).to_have_key('listed')
    End

    It lists buffers which are listed in the buffer list
      let bufnrs = []

      call add(bufnrs, g:Utils.tmp_buffer('b1'))
      call add(bufnrs, g:Utils.tmp_buffer('b2'))
      call g:Utils.tmp_buffer('b_unlisted1', 'setl nobuflisted')

      tabnew
      call add(bufnrs, g:Utils.tmp_buffer('b4'))
      call g:Utils.tmp_buffer('b_unlisted2', 'setl nobuflisted')

      wincmd s
      call add(bufnrs, g:Utils.tmp_buffer('b5'))
      call g:Utils.tmp_buffer('b_unlisted3', 'setl nobuflisted')

      let buflister = g:bufswitcher#group#groups.listed()
      for bufnr in bufnrs
        call s:expect(buflister.bufnames).to_have_key(bufnr)
      endfor
    End
  End
End
